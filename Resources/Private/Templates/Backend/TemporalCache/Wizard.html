<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers" data-namespace-typo3-fluid="true">

<f:layout name="Default" />

<f:section name="Content">
    <h1><f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.title" /></h1>

    <!-- Welcome Step -->
    <f:if condition="{step} == 'welcome'">
        <div class="card mb-4">
            <div class="card-header">
                <h4><f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.welcome.title" /></h4>
            </div>
            <div class="card-body">
                <p><f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.welcome.description" /></p>

                <div class="alert alert-info">
                    <strong><f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.welcome.current_stats" /></strong>
                    <ul class="mb-0 mt-2">
                        <li><f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.welcome.stat.total" arguments="{0: stats.totalCount}" /></li>
                        <li><f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.welcome.stat.transitions" arguments="{0: stats.transitionsPerDay}" /></li>
                        <li><f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.welcome.stat.harmonizable" arguments="{0: stats.harmonizableCandidates}" /></li>
                    </ul>
                </div>

                <div class="d-grid gap-2 mt-4">
                    <f:link.action action="wizard" arguments="{step: 'analysis'}" class="btn btn-primary btn-lg">
                        <f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.welcome.start" />
                    </f:link.action>
                </div>
            </div>
        </div>
    </f:if>

    <!-- Analysis Step -->
    <f:if condition="{step} == 'analysis'">
        <div class="card mb-4">
            <div class="card-header">
                <h4><f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.analysis.title" /></h4>
            </div>
            <div class="card-body">
                <p><f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.analysis.description" /></p>

                <!-- Recommendations -->
                <f:if condition="{recommendations}">
                    <div class="recommendations mb-4">
                        <h5><f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.analysis.recommendations" /></h5>
                        <f:for each="{recommendations}" as="recommendation">
                            <div class="alert alert-{recommendation.type}">
                                <strong><f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:{recommendation.title}" /></strong>
                                <p class="mb-0"><f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:{recommendation.message}" /></p>
                            </div>
                        </f:for>
                    </div>
                </f:if>

                <div class="d-grid gap-2">
                    <f:link.action action="wizard" arguments="{step: 'presets'}" class="btn btn-primary">
                        <f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.analysis.continue" />
                    </f:link.action>
                    <f:link.action action="wizard" arguments="{step: 'welcome'}" class="btn btn-outline-secondary">
                        <f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.back" />
                    </f:link.action>
                </div>
            </div>
        </div>
    </f:if>

    <!-- Presets Step -->
    <f:if condition="{step} == 'presets'">
        <div class="card mb-4">
            <div class="card-header">
                <h4><f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.presets.title" /></h4>
            </div>
            <div class="card-body">
                <p><f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.presets.description" /></p>

                <div class="row">
                    <f:for each="{presets}" as="preset" key="presetKey">
                        <div class="col-md-4 mb-3">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h5 class="card-title">
                                        <f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:{preset.name}" />
                                    </h5>
                                    <p class="card-text">
                                        <f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:{preset.description}" />
                                    </p>

                                    <div class="preset-details small text-muted mb-3">
                                        <div><strong>Scoping:</strong> {preset.config.scoping.strategy}</div>
                                        <div><strong>Timing:</strong> {preset.config.timing.strategy}</div>
                                        <div><strong>Harmonization:</strong>
                                            <f:if condition="{preset.config.harmonization.enabled}">
                                                <f:then>Enabled</f:then>
                                                <f:else>Disabled</f:else>
                                            </f:if>
                                        </div>
                                    </div>

                                    <button
                                        type="button"
                                        class="btn btn-primary w-100"
                                        data-preset="{presetKey}"
                                        onclick="applyPreset('{presetKey}')">
                                        <f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.presets.apply" />
                                    </button>
                                </div>
                            </div>
                        </div>
                    </f:for>
                </div>

                <div class="mt-4">
                    <div class="d-grid gap-2">
                        <f:link.action action="wizard" arguments="{step: 'custom'}" class="btn btn-outline-primary">
                            <f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.presets.custom" />
                        </f:link.action>
                        <f:link.action action="wizard" arguments="{step: 'analysis'}" class="btn btn-outline-secondary">
                            <f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.back" />
                        </f:link.action>
                    </div>
                </div>
            </div>
        </div>
    </f:if>

    <!-- Custom Configuration Step -->
    <f:if condition="{step} == 'custom'">
        <div class="card mb-4">
            <div class="card-header">
                <h4><f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.custom.title" /></h4>
            </div>
            <div class="card-body">
                <p><f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.custom.description" /></p>

                <form id="custom-config-form" method="post">
                    <!-- Scoping Strategy -->
                    <div class="mb-4">
                        <h5><f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.custom.scoping.title" /></h5>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="scoping_strategy" id="scoping-global" value="global" {f:if(condition: '{currentConfig.scoping.strategy} == \'global\'', then: 'checked')}>
                            <label class="form-check-label" for="scoping-global">
                                <strong>Global</strong> - <f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.custom.scoping.global" />
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="scoping_strategy" id="scoping-perpage" value="per-page" {f:if(condition: '{currentConfig.scoping.strategy} == \'per-page\'', then: 'checked')}>
                            <label class="form-check-label" for="scoping-perpage">
                                <strong>Per Page</strong> - <f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.custom.scoping.perpage" />
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="scoping_strategy" id="scoping-percontent" value="per-content" {f:if(condition: '{currentConfig.scoping.strategy} == \'per-content\'', then: 'checked')}>
                            <label class="form-check-label" for="scoping-percontent">
                                <strong>Per Content</strong> - <f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.custom.scoping.percontent" />
                            </label>
                        </div>
                    </div>

                    <!-- Timing Strategy -->
                    <div class="mb-4">
                        <h5><f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.custom.timing.title" /></h5>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="timing_strategy" id="timing-dynamic" value="dynamic" {f:if(condition: '{currentConfig.timing.strategy} == \'dynamic\'', then: 'checked')}>
                            <label class="form-check-label" for="timing-dynamic">
                                <strong>Dynamic</strong> - <f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.custom.timing.dynamic" />
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="timing_strategy" id="timing-scheduler" value="scheduler" {f:if(condition: '{currentConfig.timing.strategy} == \'scheduler\'', then: 'checked')}>
                            <label class="form-check-label" for="timing-scheduler">
                                <strong>Scheduler</strong> - <f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.custom.timing.scheduler" />
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="timing_strategy" id="timing-hybrid" value="hybrid" {f:if(condition: '{currentConfig.timing.strategy} == \'hybrid\'', then: 'checked')}>
                            <label class="form-check-label" for="timing-hybrid">
                                <strong>Hybrid</strong> - <f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.custom.timing.hybrid" />
                            </label>
                        </div>
                    </div>

                    <!-- Harmonization -->
                    <div class="mb-4">
                        <h5><f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.custom.harmonization.title" /></h5>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="harmonization-enabled" name="harmonization_enabled" {f:if(condition: '{currentConfig.harmonization.enabled}', then: 'checked')}>
                            <label class="form-check-label" for="harmonization-enabled">
                                <f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.custom.harmonization.enable" />
                            </label>
                        </div>
                    </div>

                    <div class="alert alert-warning">
                        <strong><f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.custom.note" /></strong>
                        <p class="mb-0"><f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.custom.note_text" /></p>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary">
                            <f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.custom.save" />
                        </button>
                        <f:link.action action="wizard" arguments="{step: 'presets'}" class="btn btn-outline-secondary">
                            <f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.back" />
                        </f:link.action>
                    </div>
                </form>
            </div>
        </div>
    </f:if>

    <!-- Summary Step -->
    <f:if condition="{step} == 'summary'">
        <div class="card mb-4">
            <div class="card-header bg-success text-white">
                <h4><f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.summary.title" /></h4>
            </div>
            <div class="card-body">
                <div class="alert alert-success">
                    <f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.summary.success" />
                </div>

                <h5><f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.summary.next_steps" /></h5>
                <ul>
                    <li><f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.summary.step1" /></li>
                    <li><f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.summary.step2" /></li>
                    <li><f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.summary.step3" /></li>
                </ul>

                <div class="d-grid gap-2 mt-4">
                    <f:link.action action="dashboard" class="btn btn-primary">
                        <f:translate key="LLL:EXT:temporal_cache/Resources/Private/Language/locallang_mod.xlf:wizard.summary.goto_dashboard" />
                    </f:link.action>
                </div>
            </div>
        </div>
    </f:if>

</f:section>

<f:section name="FooterAssets">
    <script>
        function applyPreset(presetKey) {
            if (!confirm('Apply preset "' + presetKey + '"? This will update the extension configuration.')) {
                return;
            }

            // In a real implementation, this would make an AJAX call to apply the preset
            // For now, show a message that configuration should be done in Extension Manager
            alert('Please apply this configuration in the Extension Manager:\nAdmin Tools > Settings > Extension Configuration > temporal_cache');

            // Redirect to summary
            window.location.href = '?tx_temporalcache_tools_temporalcache[action]=wizard&tx_temporalcache_tools_temporalcache[step]=summary';
        }

        document.addEventListener('DOMContentLoaded', function() {
            const customForm = document.getElementById('custom-config-form');
            if (customForm) {
                customForm.addEventListener('submit', function(e) {
                    e.preventDefault();

                    alert('Please apply this configuration in the Extension Manager:\nAdmin Tools > Settings > Extension Configuration > temporal_cache');

                    window.location.href = '?tx_temporalcache_tools_temporalcache[action]=wizard&tx_temporalcache_tools_temporalcache[step]=summary';
                });
            }
        });
    </script>
</f:section>

</html>

# Version 1.0 Implementation Plan
## Complete Feature Set - ALL Strategies, Backend Module, Tests

**Created**: 2025-10-28
**Goal**: Implement ALL features in v1.0 - per-content scoping, time harmonization, scheduler/hybrid strategies, backend module

---

## Implementation Status

### Phase 1: Configuration & Core Infrastructure ✅
- [x] ext_conf_template.txt - Extension Manager configuration
- [x] Classes/Configuration/ExtensionConfiguration.php - Central config management
- [x] Directory structure created

### Phase 2: Domain Layer (IN PROGRESS)
- [ ] Classes/Domain/Model/TemporalContent.php - Value object for temporal content
- [ ] Classes/Domain/Model/TransitionEvent.php - Value object for transitions
- [ ] Classes/Domain/Repository/TemporalContentRepository.php - Find all temporal content

### Phase 3: Service Layer - Interfaces
- [ ] Classes/Service/Scoping/ScopingStrategyInterface.php
- [ ] Classes/Service/Timing/TimingStrategyInterface.php

### Phase 4: Service Layer - Scoping Strategies
- [ ] Classes/Service/Scoping/GlobalScopingStrategy.php (Phase 1 behavior)
- [ ] Classes/Service/Scoping/PerPageScopingStrategy.php
- [ ] Classes/Service/Scoping/PerContentScopingStrategy.php (KEY FEATURE - 99% reduction)

### Phase 5: Service Layer - Timing Strategies
- [ ] Classes/Service/Timing/DynamicTimingStrategy.php (Phase 1 behavior)
- [ ] Classes/Service/Timing/SchedulerTimingStrategy.php
- [ ] Classes/Service/Timing/HybridTimingStrategy.php

### Phase 6: Service Layer - Core Services
- [ ] Classes/Service/RefindexService.php - Find pages with content using refindex
- [ ] Classes/Service/HarmonizationService.php - Time slot rounding logic
- [ ] Classes/Service/CacheInvalidationService.php - Orchestrates strategies

### Phase 7: Scheduler Integration
- [ ] Classes/Task/TemporalCacheSchedulerTask.php - Background task
- [ ] Configuration/TCA/tx_scheduler_task.php - Task configuration

### Phase 8: Backend Module
- [ ] Classes/Controller/Backend/TemporalCacheController.php
- [ ] Configuration/Backend/Routes.php - Backend routes
- [ ] Configuration/Backend/Modules.php - Module registration
- [ ] Resources/Private/Templates/Backend/TemporalCache/Dashboard.html
- [ ] Resources/Private/Templates/Backend/TemporalCache/Content.html
- [ ] Resources/Private/Templates/Backend/TemporalCache/Wizard.html
- [ ] Resources/Private/Language/locallang_mod.xlf - Backend labels

### Phase 9: Modify Existing EventListener
- [ ] Update Classes/EventListener/TemporalCacheLifetime.php to use strategies

### Phase 10: Dependency Injection
- [ ] Update Configuration/Services.yaml with all new services

### Phase 11: Testing - Unit Tests
- [ ] Tests/Unit/Configuration/ExtensionConfigurationTest.php
- [ ] Tests/Unit/Domain/Model/TemporalContentTest.php
- [ ] Tests/Unit/Service/Scoping/GlobalScopingStrategyTest.php
- [ ] Tests/Unit/Service/Scoping/PerContentScopingStrategyTest.php
- [ ] Tests/Unit/Service/Timing/DynamicTimingStrategyTest.php
- [ ] Tests/Unit/Service/Timing/SchedulerTimingStrategyTest.php
- [ ] Tests/Unit/Service/Timing/HybridTimingStrategyTest.php
- [ ] Tests/Unit/Service/HarmonizationServiceTest.php
- [ ] Tests/Unit/Service/RefindexServiceTest.php

### Phase 12: Testing - Functional Tests
- [ ] Tests/Functional/Service/Scoping/PerContentScopingIntegrationTest.php
- [ ] Tests/Functional/Service/HarmonizationIntegrationTest.php
- [ ] Tests/Functional/Task/TemporalCacheSchedulerTaskTest.php
- [ ] Tests/Functional/Backend/TemporalCacheControllerTest.php

### Phase 13: Documentation Updates
- [ ] README.md - Update with all new features
- [ ] Documentation/Configuration.rst - NEW - Configuration guide
- [ ] Documentation/Performance-Considerations.rst - Update with scoping/harmonization impact
- [ ] Documentation/Backend-Module.rst - NEW - Backend module guide
- [ ] Documentation/Migration.rst - NEW - Migration from Phase 1

### Phase 14: Quality Assurance
- [ ] Run PHPStan analysis
- [ ] Run PHP-CS-Fixer
- [ ] Run all tests (unit + functional)
- [ ] Verify TYPO3 12/13 compatibility
- [ ] Test with netresearch/typo3-conformance-skill

---

## Implementation Order

**Priority 1**: Domain + Service Layer (Core functionality)
1. Domain models
2. Service interfaces
3. Scoping strategies (especially PerContentScopingStrategy)
4. Timing strategies
5. RefindexService + HarmonizationService

**Priority 2**: Integration (Make it work)
1. Update EventListener to use strategies
2. Services.yaml configuration
3. Basic functional tests

**Priority 3**: Scheduler + Backend (User features)
1. Scheduler task
2. Backend module (all 3 tabs)
3. Backend tests

**Priority 4**: Quality (Make it production-ready)
1. Comprehensive unit tests
2. Documentation updates
3. Conformance validation

---

## Key Architecture Decisions

### Strategy Pattern
- **Scoping**: Global → Per-Page → Per-Content (pluggable)
- **Timing**: Dynamic → Scheduler → Hybrid (pluggable)
- **Independence**: Scoping and Timing are orthogonal - any combination works

### Backward Compatibility
- Default configuration = Phase 1 behavior (global + dynamic)
- All new features are OPT-IN
- Existing users see no changes until they configure new strategies

### Performance Impact
| Configuration | Cache Invalidations/Day | Overhead |
|--------------|------------------------|----------|
| Phase 1 (current) | 2,000,000 (global) | 4 queries per page |
| Per-content + Event | 600 (99.97% reduction) | 4 queries per page |
| Per-content + Harmonization | 100 (99.99% reduction) | 4 queries per page |
| Per-content + Scheduler | 100 (99.99% reduction) | ZERO per-page overhead |

---

## Testing Strategy

### Unit Tests (Target: 90% coverage)
- All services with mocked dependencies
- All strategies in isolation
- Edge cases and error handling

### Functional Tests (Target: Critical paths)
- Real database integration
- Scheduler task execution
- Backend module actions
- Cross-strategy combinations

### Manual Testing Checklist
- [ ] Extension Manager configuration UI works
- [ ] Backend module accessible and functional
- [ ] Scheduler task registration
- [ ] Per-content scoping reduces cache invalidations
- [ ] Harmonization rounds timestamps correctly
- [ ] Hybrid mode delegates correctly

---

## Success Criteria

1. ✅ **Backward Compatible**: Default behavior = Phase 1
2. ✅ **Per-Content Scoping**: 99.7% cache reduction
3. ✅ **Time Harmonization**: 98%+ transition reduction
4. ✅ **Scheduler Strategy**: Zero per-page overhead
5. ✅ **Backend Module**: Full management UI
6. ✅ **Test Coverage**: >85% unit + functional
7. ✅ **Documentation**: Complete configuration + migration guides
8. ✅ **TYPO3 Conformance**: Passes all checks

---

## Next Steps

Execute implementation in priority order, updating this document as files are completed.
